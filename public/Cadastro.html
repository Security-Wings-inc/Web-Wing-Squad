<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/cadastro.css">
    <link rel="stylesheet" href="./css/footer.css">
    <link rel="shortcut icon" href="./assets/Vector Security Wings.png" type="image/x-icon">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Yaldevi:wght@200..700&display=swap" rel="stylesheet">

</head>

<body>



    <main class="background-cadastro">
        <div class="container-cadastro">
            <div class="box-cadastro">
                <div class="logo-box-cadastro">
                    <a href="./index.html"><img class="imgLogo" src="./assets/logo-azul-escuro.svg" alt=""></a>
                </div>
                <div class="form-cadastro">

                    <h1>Criar sua conta</h1>

                    <div class="inputContent">
                        <span>Nome da empresa</span>
                        <input type="text" placeholder="" id="nomeEmpresaIpt" maxlength="100">
                    </div>

                    <div class="inputContent">
                        <span>CNPJ</span>
                        <input type="text" placeholder="" id="cnpjIpt" maxlength="18" minlength="18" oninput="formatarCNPJ(cnpjIpt)">
                    </div>

                    <div class="inputContent">
                        <span>Telefone de contato (DD + o número)</span>
                        <input type="text" placeholder="" id="telefoneIpt" maxlength="14" minlength="14" oninput="formatarTelefone(telefoneIpt)">
                    </div>

                    <div class="inputContent">
                        <span>Cidade</span>
                        <input type="text" placeholder="" id="cidadeIpt" minlength="3">
                    </div>

                    <div class="inputContent">
                        <span>Bairro</span>
                        <input type="text" placeholder="" id="bairroIpt" minlength="3">
                    </div>

                    <div class="inputContent">
                        <span>Selecione o estado no qual sua empresa se localiza</span>
                        <select name="uf" id="valorUf">
                            <option value="" disabled selected>Escolha uma opção</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>

                    <div class="inputContent">
                        <span>Rua</span>
                        <input type="text" placeholder="" id="ruaIpt" minlength="3">
                    </div>

                    <div class="inputContent">
                        <span>CEP</span>
                        <input type="text" placeholder="" id="cepIpt" maxlength="9" minlength="9"
                            oninput="formatarCEP(cepIpt)">
                    </div>

                    <div class="inputContent">
                        <span>Número</span>
                        <input type="text" placeholder="" id="compIpt" minlength="3">
                    </div>

                    <button class="buttonFinalizar" onclick="cadastrar()">Finalizar cadastro</button>
                    <label>Já possui uma conta ? <a href="./Entrar.html">Entre por aqui</a></label>

                </div>
            </div>
        </div>
    </main>

    <footer style="margin-top: 0;">
        <a href="./index.html"><img class="imgFooter" src="./assets/logo-azul-claro.svg" alt=""></a>
        <p>© 2024 Web Wings. Todos os direitos reservados. Desenvolvido por alunos da SPTECH.</p>
        <div class="socialMedia">
            <a href=""><img class="socialMediaImg" src="./assets/icon/Instagram.svg" alt=""></a>
            <a href=""><img class="socialMediaImg" src="./assets//icon/Github.svg" alt=""></a>
            <a href=""><img class="socialMediaImg" src="./assets/icon/Email.svg" alt=""> </a>
        </div>
    </footer>
</body>


</html>

<script type="module" src="js/Navbar.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<script>

    function formatarCEP(cepIpt) {
        let cep = cepIpt.value;
        cep = cep.replace(/\D/g, '');
        cep = cep.replace(/^(\d{5})(\d{3})/, '$1-$2');
        cepIpt.value = cep;
    }

    function formatarTelefone(telefoneIpt) {
        let telefone = telefoneIpt.value; // Obtém o valor do input
        telefone = telefone.replace(/\D/g, ''); // Remove caracteres não numéricos
        telefone = telefone.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3'); // Adiciona a formatação correta
        telefoneIpt.value = telefone; // Define o valor formatado de volta no input
    }


    function formatarCNPJ(cnpjIpt) {
        let cnpj = cnpjIpt.value; // Obtém o valor do input
        cnpj = cnpj.replace(/\D/g, ''); // Remove caracteres não numéricos
        cnpj = cnpj.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5'); // Aplica a formatação correta
        cnpjIpt.value = cnpj; // Define o valor formatado de volta no input
    }

    function cadastrar() {

        var nomeEmpresaVar = nomeEmpresaIpt.value;
        var cnpjVar = cnpjIpt.value;
        var telefoneVar = telefoneIpt.value;
        var cidadeVar = cidadeIpt.value;
        var bairroVar = bairroIpt.value;
        var ufVar = valorUf.value;
        var ruaVar = ruaIpt.value
        var cepVar = cepIpt.value
        var compVar = compIpt.value
        var regexNumber = /\d/



        if (nomeEmpresaVar == "" || cnpjVar == "" || telefoneVar == "" || cidadeVar == "" || bairroVar == "" || ufVar == "" || ruaVar == "" || cepVar == "" || compVar == "") {
            Swal.fire(
                "Ops...",
                "Preencha todos os campos para cadastrar sua empresa",
                "error"
            )
        } else if (cnpjVar.length !== 18) {
            Swal.fire(
                "Ops...",
                "CNPJ deve conter apenas 14 dígitos",
                "error"
            )

        } else if (telefoneVar.length !==15) {
            Swal.fire(
                "Ops",
                "O número de telefone para contato deve conter 11 dígitos (DD + 9 dígitos)",
                "error"
            )
        } else if (cepVar.length != 9) {
            Swal.fire(
                "Ops",
                "O CEP deve contem apenas 8 dígitos",
                "error"
            )
        } else if (cidadeVar < 3) {
            Swal.fire(
                "Ops",
                "O nome da cidade é muito curto",
                "error"
            )
        } else if (bairroVar.length < 3) {
            Swal.fire(
                "Ops",
                "O nome do bairro é muito curto",
                "error"
            )

        } else if (ruaVar.length < 3) {
            Swal.fire(
                "Ops",
                "O nome da rua é muito curto",
                "error"
            )

        } else if (regexNumber.test(cidadeVar)) {
            Swal.fire(
                "Ops",
                "Não deve conter números no campo cidade utilize o campo número para preecher com mais exatidão o seu endereço",
                "error"
            )

        } else if (regexNumber.test(ruaVar)) {
            Swal.fire(
                "Ops",
                "Não deve conter números no campo rua utilize o campo número para preecher com mais exatidão o seu endereço",
                "error"
            )
        } else if (regexNumber.test(bairroVar)) {
            Swal.fire(
                "Ops",
                "Não deve conter números no campo bairro utilize o campo número para preecher com mais exatidão o seu endereço",
                "error"
            )
        } else {

            console.log("entrando no fetch")
            fetch("/empresa/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    nomeEmpresaServer: nomeEmpresaVar,
                    cnpjServer: cnpjVar,
                    telefoneServer: telefoneVar,
                    cidadeServer: cidadeVar,
                    bairroServer: bairroVar,
                    ufServer: ufVar,
                    ruaServer: ruaVar,
                    cepServer: cepVar,
                    compServer: compVar,
                }),
            })
                .then(function (resposta) {
                    if (resposta.ok) {
                        Swal.fire(
                            "Sucesso",
                            "Sua empresa foi cadastrada com sucesso, entre em contato via email para estabelecer quem serão seus admin",
                            "success"
                        ).then((result)=>{
                            if(result.isConfirmed){
                                window.location = "Entrar.html"
                            }
                        })
                      
                    } else {
                        Swal.fire(
                            "Ops... ocorreu um erro",
                            "Não foi possível cadastrar sua empresa, CNPJ cadastrado",
                            "error"
                        )
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

            return false;
 }

    }


</script>