<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="../cssDashboard/dashboard.css">
  <link rel="stylesheet" href="../cssDashboard/dashboardSidebarAdmin.css">
  <link rel="shortcut icon" href="../../assets/Vector Security Wings.png" type="image/x-icon">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body onload="getMachineData()">

  <header>


    <div class="lista">

      <ul class="listaHeader">
        <li><a href="./ComputerAdmin.html"><img src="../assetsDashboard/SairIcon.svg" alt=""></a></li>
      </ul>


    </div>

  </header>

  <main>
    <div class="contentContainer">
      <div class="containerPrincipal">
        <div class="containerEsquerdo">
          <div class="containerCards">
            <div class="card">
              <h2>Armazenamento</h2>
              <span> Ocupado: 300,23 Gb </span>
              <span> Livre: 699,23 Gb </span>
              <span> Porcentagem: 80%</span>

            </div>

            <div class="card">
              <h2>Em quantos dias <br> o Armazenamento <Br> lotará</h2>
              <span>12 dias</span>
            </div>

            <div class="card">
              <h2>Velocidade da Internet</h2>
              <span> Download: 200 Mb/s </span>
              <span> Upload: 150 Mb/s </span>


            </div>

            <div class="card" style="background-color: #A9DADD;">
              <h2>Recomendações</h2>
              <span>Reduzir quantidade de processos abertos <br>
                ou aumentar a quantidade de RAM.</span>
            </div>
          </div>

          <div class="containerGraficos">

            <div class="graficoLinha">
              <div class="grafico">
                <div>
                  <h2 style="margin-top: 15px;" id="discoH2">Armazenamento <img width="15px"
                      src="../assetsDashboard/Amarelo.svg" alt=""></h2>
                  <canvas id="myChart" style="width: 512px; height: 140px;"></canvas>
                </div>


              </div>
              <div class="grafico2">
                <h2 id="ramH2"> Uso de Ram <img width="15px" src="../assetsDashboard/Verde.svg" alt=""></h2>
                <canvas id="myChart3" style="width: 460px; height: 130px;"></canvas>
              </div>
            </div>


            <div class="graficoLinha">
              <div class="grafico">
                <h2 style="margin-top: 15px;" id="cpuH2"> Utilização do processador <img width="15px"
                    src="../assetsDashboard/Verde.svg" alt=""></h2>
                <div>
                  <canvas id="myChart2" style="width: 512px; height: 140px;"></canvas>
                </div>


              </div>
              <div class="grafico2">
                <h2 id="redeH2"> Status de Rede <img width="15px" src="../assetsDashboard/Vermelho.svg" alt=""></h2>
                <canvas id="myChart4" style="width: 460px; height: 130px;"></canvas>
              </div>
            </div>
          </div>

        </div>

        <div class="containerDireito">
          <div class="containerInfo">
            <h2 style="margin-top: 20px;">Informações</h2>
            <div class="info">
              <h2 style="font-size: 15px; margin-bottom: 10px;">Armazenamento</h2>
              <span style="margin-bottom: 2px;" id="armazenamentoVerde"><img class="bola"
                  src="../assetsDashboard/Verde.svg" alt=""> 70% ou menos </span>
              <span style="margin-bottom: 2px;" id="armazenamentoAmarelo"><img class="bola"
                  src="../assetsDashboard/Amarelo.svg" alt=""> 71% até 80%</span>
              <span style="margin-bottom: 2px;" id="armazenamentoVermelho"><img class="bola"
                  src="../assetsDashboard/Vermelho.svg" alt=""> 81% ou mais</span>
              <p style="font-size: 12px;">Eixo X = Hora de captura</p>
              <p style="font-size: 12px;">Eixo Y = Porcentagem</p>

            </div>

            <div class="info">
              <h2 style="font-size: 15px; margin-bottom: 10px;">Memória Ram</h2>
              <span style="margin-bottom: 2px;" id="ramVerde"><img class="bola" src="../assetsDashboard/Verde.svg" alt=""> 50% ou
                menos </span>
              <span style="margin-bottom: 2px;" id="ramAmarelo"><img class="bola" src="../assetsDashboard/Amarelo.svg" alt=""> 51% até
                80%</span>
              <span style="margin-bottom: 2px;" id="ramVermelho"><img class="bola" src="../assetsDashboard/Vermelho.svg" alt=""> 81% ou
                mais</span>
              <p style="font-size: 12px;">Eixo X = Hora de captura</p>
              <p style="font-size: 12px;">Eixo Y = Porcentagem</p>
            </div>

            <div class="info">
              <h2 style="font-size: 15px; margin-bottom: 10px;">Processador</h2>
              <span style="margin-bottom: 2px;" id="cpuVerde"><img class="bola" src="../assetsDashboard/Verde.svg" alt=""> 70% ou
                menos </span>
              <span style="margin-bottom: 2px;" id="cpuAmarelo"><img class="bola" src="../assetsDashboard/Amarelo.svg" alt=""> 71% até
                80%</span>
              <span style="margin-bottom: 2px;" id="cpuVermelho"><img class="bola" src="../assetsDashboard/Vermelho.svg" alt=""> 81% ou
                mais</span>
              <p style="font-size: 12px;">Eixo X = Hora de captura</p>
              <p style="font-size: 12px;">Eixo Y = Porcentagem</p>

            </div>

            <div class="info">
              <h2 style="font-size: 15px; margin-bottom: 10px;">Rede</h2>

              <span style="margin-bottom: 2px;" id="redeVerde"><img class="bola" src="../assetsDashboard/Verde.svg" alt="" > rede</span>
              <span style="margin-bottom: 2px;" id="redeAmarelo"><img class="bola" src="../assetsDashboard/Amarelo.svg" alt="" >rede</span>
                  <span style="margin-bottom: 2px;" id="redeVermelho"><img class="bola" src="../assetsDashboard/Vermelho.svg" alt="" >rede<span>
                      <p style="font-size: 12px;">Eixo X = Hora de captura</p>
                      <p style="font-size: 12px;">Eixo Y = Quantidade</p>
            </div>
          </div>
        </div>
      </div>


    </div>
    </div>



  </main>

  <footer></footer>

</body>

</html>

<script>




  var nome = sessionStorage.NOME_USUARIO;
  var ramDanger = sessionStorage.RAM_DANGER;
  var ramWarning = sessionStorage.RAM_WARNING;
  var cpuDanger = sessionStorage.CPU_DANGER;
  var cpuWarning = sessionStorage.CPU_WARNING;
  var redeDanger = sessionStorage.REDE_DANGER;
  var redeWarning = sessionStorage.REDE_WARNING;
  var discoDanger = sessionStorage.HD_DANGER;
  var discoWarning = sessionStorage.HD_WARNING;

  console.log(`ram danger (${ramDanger}) , ram warning (${ramWarning}) , cpu danger(${cpuDanger}) , cpu warning (${cpuWarning}) , rede danger (${redeDanger}) , rede warning (${redeWarning}) , disco danger (${discoDanger}) , disco warning (${discoWarning})`);
  
  armazenamentoVerde.innerHTML = `<img class="bola" src="../assetsDashboard/Verde.svg" alt=""> Normal até ${discoWarning - 1}%`;
  armazenamentoAmarelo.innerHTML = `<img class="bola" src="../assetsDashboard/Amarelo.svg" alt=""> Alerta a partir de ${discoWarning}%`;
  armazenamentoVermelho.innerHTML = `<img class="bola" src="../assetsDashboard/Vermelho.svg" alt=""> Risco a partir de ${discoDanger}%`;

  ramVerde.innerHTML = `<img class="bola" src="../assetsDashboard/Verde.svg" alt=""> Normal até ${ramWarning-1}%`; 
  ramAmarelo.innerHTML = `<img class="bola" src="../assetsDashboard/Amarelo.svg" alt=""> Alerta a partir de ${ramWarning}%`; 
  ramVermelho.innerHTML = `<img class="bola" src="../assetsDashboard/Vermelho.svg" alt=""> Risco a partir de ${ramDanger}%`; 


  cpuVerde.innerHTML = `<img class="bola" src="../assetsDashboard/Verde.svg" alt=""> Normal até ${cpuWarning}%`;
  cpuAmarelo.innerHTML = `<img class="bola" src="../assetsDashboard/Amarelo.svg" alt=""> Alerta a partir de ${cpuWarning}%`;
  cpuVermelho.innerHTML = `<img class="bola" src="../assetsDashboard/Vermelho.svg" alt=""> Alerta a partir de ${cpuDanger}%`;

  redeVerde.innerHTML = `<img class="bola" src="../assetsDashboard/Verde.svg" alt=""> Normal até ${redeWarning -1} Gigabytes`
  redeAmarelo.innerHTML = `<img class="bola" src="../assetsDashboard/Amarelo.svg" alt=""> Alertar a partir de ${redeWarning} Gigabytes`
  redeVermelho.innerHTML = `<img class="bola" src="../assetsDashboard/Vermelho.svg" alt=""> Risco a partir de ${redeDanger} Gigabytes`



  var idMachine = sessionStorage.MAQUINA_SELECIONADA;
  setTimeout(() => {
    window.location.reload()
  }, 5000);

  function getMachineData() {
    fetch(`/metrica/getMachineData/${idMachine}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
    }).then(function (resposta) {
        if (resposta.ok) {
            resposta.json().then(function (resposta) {
                console.log(resposta[resposta.length - 1])

                for (let i = 0; i < resposta.length; i++) {
                    var capturas = resposta[resposta.length - 1];

                    if (capturas.discoUso >= discoDanger) {
                        discoH2.innerHTML = `Armazenamento <img width="15px" src="../assetsDashboard/Vermelho.svg">`
                    }

                    if (capturas.discoUso >= discoWarning && capturas.discoUso < discoDanger) {
                        discoH2.innerHTML = `Armazenamento <img width="15px" src="../assetsDashboard/Amarelo.svg" alt="">`
                    }

                    if (capturas.discoUso < discoWarning) {
                        discoH2.innerHTML = `Armazenamento <img width="15px" src="../assetsDashboard/Verde.svg">`
                    }

                    if (capturas.processadorUso >= cpuDanger) {
                        cpuH2.innerHTML = `Utilização do processador <img width="15px" src="../assetsDashboard/Vermelho.svg" alt="">`
                    }
                    if (capturas.processadorUso >= cpuWarning && capturas.processadorUso < cpuDanger) {
                        cpuH2.innerHTML = `Utilização do processador <img width="15px" src="../assetsDashboard/Amarelo.svg" alt="">`
                    }
                    if (capturas.processadorUso < cpuWarning) {
                        cpuH2.innerHTML = `Utilização do processador <img width="15px" src="../assetsDashboard/Verde.svg" alt="">`
                    }

                    if (capturas.ramUso >= ramDanger) {
                        ramH2.innerHTML = `Uso de Ram <img width="15px" src="../assetsDashboard/Vermelho.svg" alt="">`
                    }
                    if (capturas.ramUso >= ramWarning && capturas.ramUso <ramDanger) {
                        ramH2.innerHTML = `Uso de Ram <img width="15px" src="../assetsDashboard/Amarelo.svg" alt="">`
                    }
                    if (capturas.ramUso < ramWarning) {
                        ramH2.innerHTML = `Uso de Ram <img width="15px" src="../assetsDashboard/Verde.svg" alt="">`
                    }

                    let bytesEnviadosGB = (capturas.bytesEnviados / (1024 ** 3)).toFixed(2);

                    // Comparando os dados de bytes enviados
                    if (bytesEnviadosGB >= redeDanger) {
                        redeH2.innerHTML = `Status de Rede <img width="15px" src="../assetsDashboard/Vermelho.svg" alt="">`
                    } else if (bytesEnviadosGB >= redeWarning && bytesEnviadosGB < redeDanger) {
                        redeH2.innerHTML = `Status de Rede <img width="15px" src="../assetsDashboard/Amarelo.svg" alt="">`
                    } else {
                        redeH2.innerHTML = `Status de Rede <img width="15px" src="../assetsDashboard/Verde.svg" alt="">`
                    }

                }

                armazenamento(resposta);
                processador(resposta);
                ram(resposta);
                rede(resposta);

            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
}

  function armazenamento(dados) {

    const ctx = document.getElementById('myChart');
    const labels = dados.slice(-8).map(dado => dado.dataCaptura);
    const dataPoints = dados.slice(-8).map(dado => dado.discoUso);

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Porcentagem de uso de armazenamento',
          data: dataPoints,
          borderWidth: 1,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  function processador(dados) {

    const ctx2 = document.getElementById('myChart2');
    const labels = dados.slice(-8).map(dado => dado.dataCaptura);
    const dataPoints = dados.slice(-8).map(dado => dado.processadorUso);

    new Chart(ctx2, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Porcentagem de utilização do processador',
          data: dataPoints,
          borderWidth: 1,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
        }]
      },
      options: {

        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }



  function ram(dados) {

    const ctx3 = document.getElementById('myChart3');
    const labels = dados.slice(-8).map(dado => dado.dataCaptura);
    const dataPoints = dados.slice(-8).map(dado => dado.ramUso);

    new Chart(ctx3, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Porcentagem de ram em uso',
          data: dataPoints,
          borderWidth: 1,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
        }]
      },
      options: {

        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  function rede(dados) {
    const ctx4 = document.getElementById('myChart4');
    const labels = dados.slice(-8).map(dado => dado.dataCaptura);
    const dataBytesRecebidos = dados.slice(-8).map(dado => (dado.bytesRecebidos / (1024 ** 3)).toFixed(2));
    const dataBytesEnviados = dados.slice(-8).map(dado => (dado.bytesEnviados / (1024 ** 3)).toFixed(2));

    new Chart(ctx4, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'GB enviados',
                    data: dataBytesEnviados,
                    borderWidth: 1,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

</script>